# Keen-One Astronomy Stack
# Docker Compose for INDI Server and Astronomy Tools
#
# This stack provides:
# - INDI Server for telescope control (with OnStep LX200 driver)
# - Connects to OnStepX mount via TCP/IP
#
# Usage:
#   docker compose up -d
#
# Connect from Stellarium/KStars:
#   Host: localhost (or your Docker host IP)
#   Port: 7624 (INDI protocol)
#
# Mount Connection:
#   Configure in INDI client: TCP connection to ${ONSTEP_IP}:${ONSTEP_PORT}

services:
  # ==========================================================================
  # INDI Server - Core telescope control with OnStep driver
  # ==========================================================================
  indiserver:
    image: silfreed/indilib:latest
    container_name: indiserver
    restart: unless-stopped
    ports:
      - "7624:7624"
    environment:
      - TZ=${TIMEZONE:-Europe/London}
    volumes:
      - ./indi/config:/root/.indi
    # Start INDI server with OnStep LX200 driver
    # The driver connects to the mount via TCP (configured in INDI client)
    command: ["-v", "indi_lx200_OnStep"]
    # Additional drivers available in this image:
    # indi_lx200basic, indi_lx200generic, indi_simulator_telescope
    # indi_asi_ccd, indi_qhy_ccd (for cameras)
    labels:
      - "com.centurylinklabs.watchtower.enable=true"
    healthcheck:
      test: ["CMD", "nc", "-z", "localhost", "7624"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s

  # ==========================================================================
  # Astrometry.net - Local plate solving (optional, large download)
  # ==========================================================================
  # Uncomment to enable plate solving. First run downloads ~2GB of index files.
  #
  # astrometry:
  #   image: dm90/astrometry:latest
  #   container_name: astrometry
  #   restart: unless-stopped
  #   ports:
  #     - "8090:8090"
  #   environment:
  #     - TZ=${TIMEZONE:-Europe/London}
  #   volumes:
  #     - astrometry-data:/data
  #   labels:
  #     - "com.centurylinklabs.watchtower.enable=true"

volumes:
  astrometry-data:
    name: astronomy-astrometry-data

networks:
  default:
    name: astronomy
